<script>
    // Controle avançado dos popups
    document.addEventListener('DOMContentLoaded', function() {
        const isMobile = window.innerWidth <= 992;
        
        // Criar overlay para mobile
        if (isMobile) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            document.body.appendChild(overlay);
            
            // Fecha popups ao clicar no overlay
            overlay.addEventListener('click', function() {
                closeAllPopups();
            });
        }
        
        // Função para fechar todos os popups
        function closeAllPopups() {
            document.querySelectorAll('.service-popup, .bio-popup').forEach(popup => {
                popup.style.display = 'none';
                popup.classList.remove('active');
            });
            if (isMobile) {
                document.querySelector('.popup-overlay').style.display = 'none';
            }
        }
        
        // Controle para DESKTOP (hover)
        if (!isMobile) {
            // Fecha popups ao clicar fora (desktop)
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.service-card') && 
                    !e.target.closest('.photo-placeholder') && 
                    !e.target.closest('.bio-popup') &&
                    !e.target.closest('.service-popup')) {
                    closeAllPopups();
                }
            });
            
            // Fecha bio ao clicar fora (exceto na foto)
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.photo-placeholder') && 
                    !e.target.closest('.bio-popup')) {
                    document.querySelector('.bio-popup').style.display = 'none';
                }
            });
        }
        // Controle para MOBILE (clique/touch)
        else {
            // Serviços - clique/touch
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const popup = this.querySelector('.service-popup');
                    const wasActive = popup.classList.contains('active');
                    
                    // Fecha todos os outros
                    closeAllPopups();
                    
                    // Abre/fecha este
                    if (!wasActive) {
                        popup.style.display = 'block';
                        popup.classList.add('active');
                        document.querySelector('.popup-overlay').style.display = 'block';
                    }
                });
            });
            
            // Bio - clique/touch
            document.querySelector('.photo-placeholder').addEventListener('click', function(e) {
                e.stopPropagation();
                const popup = document.querySelector('.bio-popup');
                const wasActive = popup.classList.contains('active');
                
                // Fecha todos os outros
                closeAllPopups();
                
                // Abre/fecha bio
                if (!wasActive) {
                    popup.style.display = 'block';
                    popup.classList.add('active');
                    document.querySelector('.popup-overlay').style.display = 'block';
                }
            });
            
            // Botão de fechar nos popups (opcional)
            document.querySelectorAll('.service-popup, .bio-popup').forEach(popup => {
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '×';
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: #ef4444;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    font-size: 20px;
                    cursor: pointer;
                    z-index: 10000;
                `;
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    closeAllPopups();
                });
                popup.appendChild(closeBtn);
            });
            
            // Fecha com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllPopups();
                }
            });
        }
        
        // Log para debug
        console.log('Site do Dr. Marcelo carregado. Mobile:', isMobile);
    });
</script>
